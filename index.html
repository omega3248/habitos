<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habi</title>
<link rel="manifest" href="manifest.json">
<style>
body{background:#000;color:#fff;font-family:sans-serif;margin:0;padding:20px;max-width:600px;margin:auto}
h1{text-align:center;color:#00aaff}
button{background:#00aaff;border:none;color:#fff;padding:10px;margin:5px;width:100%;border-radius:10px;font-size:16px}
button.completado{background:#333;text-decoration:line-through;color:#888}
canvas{width:100%;height:200px;margin-top:20px}
</style>
</head>
<body>
<h1>Habi</h1>
<div id="habitos"></div>
<canvas id="grafica"></canvas>
<script>
const habitos = [
"Beber 2.5 L de agua",
"Dormir 8 horas",
"Hacer 30 min de ejercicio",
"Comer frutas o verduras",
"Evitar azúcar refinada",
"Meditar o relajarse 10 min",
"Hacer tarea",
"No usar el celular al despertar",
"Leer al menos 10 páginas",
"Agradecer tres cosas del día"
];

const hoy = new Date().toDateString();
if(localStorage.getItem("fecha")!==hoy){localStorage.clear();localStorage.setItem("fecha",hoy);}

const cont = document.getElementById("habitos");
habitos.forEach((h,i)=>{
  const b=document.createElement("button");
  b.textContent=h;
  if(localStorage.getItem("h"+i)==="1")b.classList.add("completado");
  b.onclick=()=>{
    const c=b.classList.toggle("completado");
    localStorage.setItem("h"+i,c?"1":"0");
    actualizarGrafica();
  };
  cont.appendChild(b);
});

function obtenerPuntajeDia(){
  let completados=0;
  habitos.forEach((_,i)=>{if(localStorage.getItem("h"+i)==="1")completados++;});
  return completados/habitos.length;
}

function actualizarGrafica(){
  const ctx=document.getElementById("grafica").getContext("2d");
  const datos=JSON.parse(localStorage.getItem("semana")||"[]");
  const hoyIndice=new Date().getDay();
  datos[hoyIndice]=obtenerPuntajeDia();
  localStorage.setItem("semana",JSON.stringify(datos));
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
  const w=ctx.canvas.width,h=ctx.canvas.height;
  ctx.beginPath();
  ctx.moveTo(0,h);
  datos.forEach((v,i)=>ctx.lineTo((i/(datos.length-1||1))*w,h-v*h));
  ctx.lineTo(w,h);ctx.closePath();
  const grad=ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,"#00aaffaa");
  grad.addColorStop(1,"#000");
  ctx.fillStyle=grad;ctx.fill();
  ctx.strokeStyle="#00aaff";ctx.lineWidth=2;ctx.stroke();
}
actualizarGrafica();
</script>
</body>
</html>