<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habi</title>
<link rel="manifest" href="manifest.json">
<style>
body {
  background-color: #0b0b0b;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 { color: #00aaff; margin-top: 20px; }
#chart-container { width: 90%; max-width: 600px; margin: 20px auto; }
canvas { background-color: #111; border-radius: 10px; }
.habit { margin: 10px 0; }
button {
  background-color: #00aaff;
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
}
button.completed { background-color: #004466; }
#selector {
  margin: 20px auto;
  background-color: #111;
  border: 1px solid #00aaff;
  border-radius: 10px;
  padding: 10px;
  width: fit-content;
}
#selector select {
  background: #0b0b0b;
  color: #00aaff;
  border: none;
  font-size: 16px;
}
</style>
</head>
<body>
<h1>∞ Habi</h1>

<div id="habits"></div>

<div id="selector">
  <label for="range">Ver progreso:</label>
  <select id="range">
    <option value="week">Semana</option>
    <option value="month">Mes</option>
    <option value="6months">6 meses</option>
    <option value="year">Año</option>
    <option value="all">Todo</option>
  </select>
</div>

<div id="chart-container">
  <canvas id="progressChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const habits = [
  "Beber 2.5L de agua", "Dormir 8 horas", "Hacer 30 minutos de ejercicio",
  "Meditar 10 minutos", "Leer 20 páginas", "Evitar comida chatarra",
  "Hacer tarea", "Pasar tiempo con familia", "Practicar gratitud",
  "Evitar redes sociales por 1h"
];
const today = new Date().toISOString().split('T')[0];
let data = JSON.parse(localStorage.getItem('habiData')) || {};
if (!data[today]) data[today] = { completed: [] };
updateHabits();

function updateHabits() {
  const container = document.getElementById('habits');
  container.innerHTML = '';
  habits.forEach((h, i) => {
    const btn = document.createElement('button');
    btn.textContent = h;
    btn.className = 'habit' + (data[today].completed.includes(i) ? ' completed' : '');
    btn.onclick = () => toggleHabit(i, btn);
    container.appendChild(btn);
  });
}

function toggleHabit(i, btn) {
  const completed = data[today].completed;
  if (completed.includes(i)) {
    data[today].completed = completed.filter(x => x !== i);
  } else {
    completed.push(i);
  }
  localStorage.setItem('habiData', JSON.stringify(data));
  btn.classList.toggle('completed');
  renderChart();
}

function renderChart() {
  const range = document.getElementById('range').value;
  const entries = Object.entries(data).sort(([a], [b]) => new Date(a) - new Date(b));
  const now = new Date();
  const filtered = entries.filter(([d]) => {
    const date = new Date(d);
    if (range === 'week') return (now - date) / (1000*60*60*24) <= 7;
    if (range === 'month') return (now - date) / (1000*60*60*24) <= 30;
    if (range === '6months') return (now - date) / (1000*60*60*24) <= 183;
    if (range === 'year') return (now - date) / (1000*60*60*24) <= 365;
    return true;
  });

  const labels = filtered.map(([d]) => d);
  const values = filtered.map(([_, val]) => val.completed.length / habits.length * 100);

  const ctx = document.getElementById('progressChart').getContext('2d');
  if (window.chart) window.chart.destroy();
  window.chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Progreso (%)',
        data: values,
        fill: true,
        borderColor: '#00aaff',
        backgroundColor: 'rgba(0,170,255,0.2)',
        tension: 0.3
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, max: 100 } },
      plugins: { legend: { display: false } }
    }
  });
}
document.getElementById('range').addEventListener('change', renderChart);
renderChart();
</script>
</body>
</html>
